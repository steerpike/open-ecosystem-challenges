
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../beginner/">
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>üü° Intermediate - Open Ecosystem Challenges</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intermediate-solution-walkthrough-the-silent-canary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Open Ecosystem Challenges" class="md-header__button md-logo" aria-label="Open Ecosystem Challenges" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Open Ecosystem Challenges
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              üü° Intermediate
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-oss/open-ecosystem-challenges" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    View on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Open Ecosystem Challenges" class="md-nav__button md-logo" aria-label="Open Ecosystem Challenges" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Open Ecosystem Challenges
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-oss/open-ecosystem-challenges" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    View on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How to Play
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    How to Play
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../start-a-challenge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Start a Challenge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Verify Your Solution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Adventures
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Adventures
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üõ∞Ô∏è 01: Echoes Lost in Orbit
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    üõ∞Ô∏è 01: Echoes Lost in Orbit
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üü¢ Beginner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üü° Intermediate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../expert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üî¥ Expert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_5" id="__nav_3_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Solutions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Solutions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../beginner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üü¢ Beginner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    üü° Intermediate
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    üü° Intermediate
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-review-the-challenge-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìã Step 1: Review the Challenge Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-understand-the-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîç Step 2: Understand the Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-clear-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ Step 3: Clear Objectives
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Step 3: Clear Objectives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objective-1-pod-info-version-693-deployed-successfully-in-both-staging-and-production-environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 1: Pod info version 6.9.3 deployed successfully in both staging and production environments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 1: Pod info version 6.9.3 deployed successfully in both staging and production environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-fix" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to fix?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-2-rollouts-automatically-progress-through-canary-stages-based-on-health-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 2: Rollouts automatically progress through canary stages based on health metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 2: Rollouts automatically progress through canary stages based on health metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-fix_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to fix?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-takeaways_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-3-two-working-promql-queries-in-the-analysistemplate-that-validate-application-health-during-releases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 3: Two working PromQL queries in the AnalysisTemplate that validate application health during releases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 3: Two working PromQL queries in the AnalysisTemplate that validate application health during releases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-4-all-rollouts-complete-successfully" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 4: All rollouts complete successfully
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚úÖ Complete Solution
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-review-the-challenge-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìã Step 1: Review the Challenge Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-understand-the-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîç Step 2: Understand the Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-clear-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ Step 3: Clear Objectives
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Step 3: Clear Objectives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objective-1-pod-info-version-693-deployed-successfully-in-both-staging-and-production-environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 1: Pod info version 6.9.3 deployed successfully in both staging and production environments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 1: Pod info version 6.9.3 deployed successfully in both staging and production environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-fix" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to fix?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-2-rollouts-automatically-progress-through-canary-stages-based-on-health-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 2: Rollouts automatically progress through canary stages based on health metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 2: Rollouts automatically progress through canary stages based on health metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-fix_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to fix?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-takeaways_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-3-two-working-promql-queries-in-the-analysistemplate-that-validate-application-health-during-releases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 3: Two working PromQL queries in the AnalysisTemplate that validate application health during releases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective 3: Two working PromQL queries in the AnalysisTemplate that validate application health during releases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objective-4-all-rollouts-complete-successfully" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objective 4: All rollouts complete successfully
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚úÖ Complete Solution
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="intermediate-solution-walkthrough-the-silent-canary">üü° Intermediate Solution Walkthrough: The Silent Canary<a class="headerlink" href="#intermediate-solution-walkthrough-the-silent-canary" title="Permanent link">#</a></h1>
<p>In this walkthrough, we'll approach the challenge exactly as you would: start with the objectives, break them down one by one, and systematically fix what's broken. üöÄ</p>
<blockquote>
<p>‚ö†Ô∏è Spoiler Alert: This walkthrough contains the full solution to the challenge. We encourage you to try solving it on your own first. Consider coming back here only if you get stuck or want to check your approach.</p>
</blockquote>
<h2 id="step-1-review-the-challenge-objectives">üìã Step 1: Review the Challenge Objectives<a class="headerlink" href="#step-1-review-the-challenge-objectives" title="Permanent link">#</a></h2>
<p>Let's start by reading what we need to achieve. The challenge states:</p>
<blockquote>
<p>By the end of this level, you should have:</p>
<ul>
<li>Pod info version 6.9.3 deployed successfully in both staging and production environments</li>
<li>Rollouts automatically progress through canary stages based on health metrics</li>
<li>Two working PromQL queries in the AnalysisTemplate that validate application health during releases</li>
<li>All rollouts complete successfully</li>
</ul>
</blockquote>
<p>Perfect! Now we have four clear objectives to work toward. Let's tackle them one by one.</p>
<h2 id="step-2-understand-the-setup">üîç Step 2: Understand the Setup<a class="headerlink" href="#step-2-understand-the-setup" title="Permanent link">#</a></h2>
<p>Before we start fixing things, let's understand what we're working with. All files are located in the following path:</p>
<div class="highlight"><pre><span></span><code>adventures/01-echoes-lost-in-orbit/intermediate/manifests
</code></pre></div>
<p>Let's see what it contains:</p>
<ul>
<li><code>appset.yaml</code>: An <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/">Argo CD ApplicationSet</a> that generates Applications for staging and prod using the Git directory generator</li>
<li><code>base/</code>: The base configuration for the echo-server app which is deployed using <a href="https://kustomize.io/">Kustomize</a><ul>
<li><code>analysis-template.yaml</code>: An <a href="https://argo-rollouts.readthedocs.io/en/stable/features/analysis/">Argo Rollouts AnalysisTemplate</a> that defines health checks during canary deployments</li>
<li><code>rollout.yaml</code>: An <a href="https://argo-rollouts.readthedocs.io/en/stable/">Argo Rollouts Rollout</a> resource that manages the canary deployment strategy</li>
<li><code>service.yaml</code>: A Kubernetes Service that exposes the echo-server app</li>
<li><code>kustomization.yaml</code>: Kustomize configuration file for the base</li>
</ul>
</li>
<li><code>overlays/</code>: Environment-specific overlays for staging and prod<ul>
<li><code>kustomization.yaml</code>: Kustomize configuration that adjust the number of replicas for each overlay</li>
</ul>
</li>
</ul>
<p>Now let's work through each objective.</p>
<h2 id="step-3-clear-objectives">üéØ Step 3: Clear Objectives<a class="headerlink" href="#step-3-clear-objectives" title="Permanent link">#</a></h2>
<blockquote>
<p><strong>Note:</strong> All steps in this guide use the staging environment. Since staging and production are identical (except for the number of replicas), you can follow the same steps for both. To keep things simple, we'll only mention staging throughout.</p>
</blockquote>
<h3 id="objective-1-pod-info-version-693-deployed-successfully-in-both-staging-and-production-environments">Objective 1: Pod info version 6.9.3 deployed successfully in both staging and production environments<a class="headerlink" href="#objective-1-pod-info-version-693-deployed-successfully-in-both-staging-and-production-environments" title="Permanent link">#</a></h3>
<p>Let's start by checking which version of the podinfo image is currently running in staging:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>echo-staging<span class="w"> </span>get<span class="w"> </span>rollout<span class="w"> </span>echo-server<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div>
<p>Let's look for the <code>spec.template.spec.containers[0].image</code> field. It should be set to <code>stefanprodan/podinfo:6.9.3</code>. Perfect, that's the version we want. However, if we scroll down to the <code>status</code> section, we'll notice an error:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Rollout</span><span class="nv"> </span><span class="s">aborted</span><span class="nv"> </span><span class="s">update</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">revision</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Metric</span><span class="nv"> </span><span class="s">&quot;container-restarts&quot;</span><span class="nv"> </span><span class="s">assessed</span>
<span class="w">      </span><span class="s">Error</span><span class="nv"> </span><span class="s">due</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">consecutiveErrors</span><span class="nv"> </span><span class="s">(1)</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">consecutiveErrorLimit</span><span class="nv"> </span><span class="s">(0):</span><span class="nv"> </span><span class="s">&quot;Error</span><span class="nv"> </span><span class="s">Message:</span>
<span class="w">      </span><span class="s">Post</span><span class="nv"> </span><span class="s">&quot;http://prom-server.prometheus.svc.cluster.local/api/v1/query&quot;:</span><span class="nv"> </span><span class="s">dial</span><span class="nv"> </span><span class="s">tcp:</span>
<span class="w">      </span><span class="s">lookup</span><span class="nv"> </span><span class="s">prom-server.prometheus.svc.cluster.local</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">10.96.0.10:53:</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">such</span><span class="nv"> </span><span class="s">host&quot;&#39;</span>
<span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RolloutAborted</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Progressing</span>
</code></pre></div>
<p>Let's find out which version is actually running. The rollout status includes a field called <code>status.stableRS</code>, which tells us the unique identifier of the replicaset that is currently considered stable (i.e., the one serving traffic). To understand what is actually running in our cluster, we can inspect this replicaset directly:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># status.stableRS: 6fdd67656d</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>echo-staging<span class="w"> </span>get<span class="w"> </span>replicaset<span class="w"> </span>echo-server-6fdd67656d<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div>
<p>Let's look for the spec.template.spec.containers[0].image field in the output. In this case, we see:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo-server</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stefanprodan/podinfo:6.8.0</span>
</code></pre></div>
<p>This tells us that the old image (<code>6.8.0</code>) is still running, even though we expect <code>6.9.3</code>. This means that the rollout is stuck and hasn't progressed to the new version.</p>
<p>If we open the Argo Rollouts UI and select the <code>echo-staging</code> namespace in the top right corner, we'll see an error in the rollout‚Äîthis matches the output from the previous command.</p>
<p><img alt="Failed Release" src="../images/intermediate/failed-release.png" /></p>
<h4 id="how-to-fix">How to fix?<a class="headerlink" href="#how-to-fix" title="Permanent link">#</a></h4>
<p>We don't need to push image 6.9.3 because that has already been done. The problem is that the rollout is aborted due to an error. Let's move on to the next objective to investigate further.</p>
<h4 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">#</a></h4>
<ul>
<li>Argo Rollouts won't progress a rollout if there are errors in the configuration.</li>
<li>Check the rollout status and conditions for errors when rollouts don't progress.</li>
</ul>
<h4 id="further-reading">Further Reading<a class="headerlink" href="#further-reading" title="Permanent link">#</a></h4>
<ul>
<li><a href="https://argo-rollouts.readthedocs.io/en/stable/concepts/">Progressive Delivery with Argo Rollouts</a></li>
</ul>
<h3 id="objective-2-rollouts-automatically-progress-through-canary-stages-based-on-health-metrics">Objective 2: Rollouts automatically progress through canary stages based on health metrics<a class="headerlink" href="#objective-2-rollouts-automatically-progress-through-canary-stages-based-on-health-metrics" title="Permanent link">#</a></h3>
<p>As described in the previous objective, our rollout is currently not progressing due to an error. Let's investigate exactly what's going on.</p>
<h4 id="how-to-fix_1">How to fix?<a class="headerlink" href="#how-to-fix_1" title="Permanent link">#</a></h4>
<p>First, let's take a closer look at the error message by running:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>echo-staging<span class="w"> </span>get<span class="w"> </span>rollout<span class="w"> </span>echo-server<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div>
<p>In the output, we see this condition:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Rollout</span><span class="nv"> </span><span class="s">aborted</span><span class="nv"> </span><span class="s">update</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">revision</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Metric</span><span class="nv"> </span><span class="s">&quot;container-restarts&quot;</span><span class="nv"> </span><span class="s">assessed</span>
<span class="w">      </span><span class="s">Error</span><span class="nv"> </span><span class="s">due</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">consecutiveErrors</span><span class="nv"> </span><span class="s">(1)</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">consecutiveErrorLimit</span><span class="nv"> </span><span class="s">(0):</span><span class="nv"> </span><span class="s">&quot;Error</span><span class="nv"> </span><span class="s">Message:</span>
<span class="w">      </span><span class="s">Post</span><span class="nv"> </span><span class="s">&quot;http://prom-server.prometheus.svc.cluster.local/api/v1/query&quot;:</span><span class="nv"> </span><span class="s">dial</span><span class="nv"> </span><span class="s">tcp:</span>
<span class="w">      </span><span class="s">lookup</span><span class="nv"> </span><span class="s">prom-server.prometheus.svc.cluster.local</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">10.96.0.10:53:</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">such</span><span class="nv"> </span><span class="s">host&quot;&#39;</span>
<span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RolloutAborted</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;False&quot;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Progressing</span>
</code></pre></div>
<p>This tells us that the <code>container-restarts</code> metric is failing because it can't reach the Prometheus server. This is likely due to an incorrect URL in our AnalysisTemplate.</p>
<p>Let's check the AnalysisTemplate by running:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>echo-staging<span class="w"> </span>get<span class="w"> </span>analysistemplate<span class="w"> </span>echo-analysis<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div>
<p>Or, we can simply look at the file in the repo at <code>adventures/01-echoes-lost-in-orbit/intermediate/manifests/base/analysis-template.yaml</code>.</p>
<p>We see that the spec contains two metrics: <code>container-restarts</code> and <code>ready-containers</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">consecutiveErrorLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">failureLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">inconclusiveLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container-restarts</span>
<span class="w">    </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">      </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prom-server.prometheus.svc.cluster.local</span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no"># There should be no restarts</span>
<span class="w">          </span><span class="no">sum(increase(kube_pod_container_status_restarts_total{</span>
<span class="w">            </span><span class="no">namespace=&quot;{{args.namespace}}&quot;,</span>
<span class="w">            </span><span class="no">pod=~&quot;echo-server-.*&quot;</span>
<span class="w">          </span><span class="no">}[1m])) or vector(0)</span>
<span class="w">    </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result[0] &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">consecutiveErrorLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">failureLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">inconclusiveLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ready-containers</span>
<span class="w">    </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">      </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prometheus-server.prometheus.svc.cluster.local</span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">          </span><span class="no"># Check how many containers are ready (should be at least 1)</span>
<span class="w">          </span><span class="no"># Look at kube_pod_container_status_* metrics</span>
<span class="w">          </span><span class="no"># Test in Prometheus UI (port 30102 in the &quot;Ports&quot; tab of VS Code)</span>
<span class="w">    </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result[0] &gt;= 1</span>
</code></pre></div>
<p>According to the error message, the problem is with the <code>container-restarts</code> metric: it can't reach the Prometheus server at <code>http://prom-server.prometheus.svc.cluster.local</code>.</p>
<p>Let's check if this service exists. The URL follows the structure <code>http://&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code>, so we run:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>prometheus<span class="w"> </span>get<span class="w"> </span>service
</code></pre></div>
<p>This outputs one service called <code>prometheus-server</code>, not <code>prom-server</code>. It looks like there's a typo in our manifest. Let's fix it by changing <code>prom-server</code> to <code>prometheus-server</code> in <code>adventures/01-echoes-lost-in-orbit/intermediate/manifests/base/analysis-template.yaml</code>.</p>
<p>After making the change, let's commit and push. For more details, see the <a href="../../intermediate/#deploy-your-changes">challenge instructions</a>.</p>
<p>Now, let's retry the rollout:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>argo<span class="w"> </span>rollouts<span class="w"> </span>retry<span class="w"> </span>rollout<span class="w"> </span>echo-server<span class="w"> </span>-n<span class="w"> </span>echo-staging
</code></pre></div>
<p>This time, instead of using plain <code>kubectl</code>, let's use the Argo Rollouts kubectl plugin for more detailed status:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>argo<span class="w"> </span>rollouts<span class="w"> </span>-n<span class="w"> </span>echo-staging<span class="w"> </span>status<span class="w"> </span>echo-server
</code></pre></div>
<p>We see that the rollout is still not progressing:</p>
<div class="highlight"><pre><span></span><code>Degraded - RolloutAborted: Rollout aborted update to revision 2: Metric &quot;container-restarts&quot; assessed Failed due to failed (1) &gt; failureLimit (0)
Error: The rollout is in a degraded state with message: RolloutAborted: Rollout aborted update to revision 2: Metric &quot;container-restarts&quot; assessed Failed due to failed (1) &gt; failureLimit (0)
</code></pre></div>
<p>At least now we have a new error! The <code>container-restarts</code> metric is failing because there was one failure, but the failure limit for the rollout to proceed is set to 0.</p>
<p>Let's look at the current configuration:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container-restarts</span>
<span class="w">      </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result[0] &gt; 0</span>
<span class="w">      </span><span class="nt">failureLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">inconclusiveLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">consecutiveErrorLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prometheus-server.prometheus.svc.cluster.local</span>
<span class="w">          </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no"># There should be no restarts</span>
<span class="w">            </span><span class="no">sum(increase(kube_pod_container_status_restarts_total{</span>
<span class="w">              </span><span class="no">namespace=&quot;{{args.namespace}}&quot;,</span>
<span class="w">              </span><span class="no">pod=~&quot;echo-server-.*&quot;</span>
<span class="w">            </span><span class="no">}[1m])) or vector(0)</span>
</code></pre></div>
<p>The query checks for the number of container restarts in the last minute. If there are no restarts, the query returns 0. As the comment says, there should be no container restarts for success.</p>
<p>But the success condition is set to <code>result[0] &gt; 0</code>, which means the metric only succeeds if there is at least one restart. That's the opposite of what we want! Let's change the success condition to <code>result[0] == 0</code>.</p>
<p>After updating, commit and push your changes, then retry the rollout:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>argo<span class="w"> </span>rollouts<span class="w"> </span>retry<span class="w"> </span>rollout<span class="w"> </span>echo-server<span class="w"> </span>-n<span class="w"> </span>echo-staging
</code></pre></div>
<p>This time, let's use the Argo Rollouts UI to check the status. Open the UI, select the <code>echo-staging</code> namespace in the top right, and click on the rollout card.</p>
<p>After waiting a bit, we see the rollout still hasn't progressed and there are three analysis runs:</p>
<p><img alt="Analysis Runs" src="../images/intermediate/argo-rollouts-ui-status.png" /></p>
<p>Clicking on <code>Analysis 2-1</code> shows the first error (wrong service), <code>Analysis 2-1.1</code> shows the previous error (wrong success condition), and <code>Analysis 2-1.2</code> is the latest error. Let's take a closer look:</p>
<p><img alt="Analysis Error" src="../images/intermediate/analysis-error.png" /></p>
<p>Here, we see that the <code>container-restarts</code> metric was finally successful, but <code>ready-containers</code> is still failing. Let's click the metric on the left to investigate the query. It turns out it simply wasn't implemented yet:</p>
<p><img alt="Analysis Error - Query" src="../images/intermediate/analysis-error-query.png" /></p>
<p>Let's follow the comment and open the Prometheus UI to find a metric that helps us check the number of ready containers. By entering <code>kube_pod_container_status_</code>, autocompletion shows all available metrics. Let's choose <code>kube_pod_container_status_ready</code>.</p>
<p><img alt="Prometheus UI - Metric Selection" src="../images/intermediate/prometheus-metrics.png" /></p>
<p>Just like with the container-restarts metric, we want to filter for our namespace and pod. Let's add this and execute the query:</p>
<div class="highlight"><pre><span></span><code><span class="n">kube_pod_container_status_ready</span><span class="err">{</span>
<span class="w">  </span><span class="n">namespace</span><span class="o">=</span><span class="ss">&quot;echo-staging&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">pod</span><span class="o">=~</span><span class="ss">&quot;echo-server-.*&quot;</span>
<span class="err">}</span>
</code></pre></div>
<p>This returns all ready containers for our pods:</p>
<p><img alt="Prometheus UI - Ready Containers" src="../images/intermediate/prometheus-ready-containers-query.png" /></p>
<p>But we don't want a list of all ready containers‚Äîwe want to check if there is at least one ready container. So, let's use the sum aggregator:</p>
<div class="highlight"><pre><span></span><code><span class="k">sum</span><span class="p">(</span>
<span class="w">  </span><span class="n">kube_pod_container_status_ready</span><span class="err">{</span>
<span class="w">    </span><span class="n">namespace</span><span class="o">=</span><span class="ss">&quot;echo-staging&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">pod</span><span class="o">=~</span><span class="ss">&quot;echo-server-.*&quot;</span>
<span class="w">  </span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="Prometheus UI - Ready Containers Sum" src="../images/intermediate/prometheus-ready-containers-query-sum.png" /></p>
<p>Nice! Now the query returns "1" instead of a list, which is exactly what we want.</p>
<p>Before adding this to our manifest, let's remember we have two environments. Instead of hardcoding the namespace, let's use the same approach as in the other metric and use the <code>{{args.namespace}}</code> placeholder.</p>
<p>The final query looks like this (with <code>or vector(0)</code> at the end to ensure the query returns 0 if no data is found):</p>
<div class="highlight"><pre><span></span><code><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">  </span><span class="no"># Check how many containers are ready (should be at least 1)</span>
<span class="w">  </span><span class="no">sum(kube_pod_container_status_ready{</span>
<span class="w">    </span><span class="no">namespace=&quot;{{args.namespace}}&quot;,</span>
<span class="w">    </span><span class="no">pod=~&quot;echo-server-.*&quot;</span>
<span class="w">  </span><span class="no">}) or vector(0)</span>
</code></pre></div>
<p>Let's add this to our manifest, commit, push, refresh, and retry again.</p>
<p>Yay! This time, the rollout actually progressed and the analysis runs are successful‚Äîobjective met! üéâ</p>
<h4 id="key-takeaways_1">Key Takeaways<a class="headerlink" href="#key-takeaways_1" title="Permanent link">#</a></h4>
<ul>
<li>There are multiple effective ways to debug Argo Rollouts. Try them and use your favorite.</li>
<li>Service references use the format <code>svc.namespace.svc.cluster.local</code>.</li>
<li>Prometheus queries are a simple and effective way to validate application health during rollouts.</li>
<li>The Prometheus UI is a great way to test and build your queries.</li>
</ul>
<h4 id="further-reading_1">Further Reading<a class="headerlink" href="#further-reading_1" title="Permanent link">#</a></h4>
<ul>
<li><a href="https://argo-rollouts.readthedocs.io/en/stable/features/analysis/">Argo Rollouts Analysis</a></li>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">Prometheus Querying Basics</a></li>
</ul>
<h3 id="objective-3-two-working-promql-queries-in-the-analysistemplate-that-validate-application-health-during-releases">Objective 3: Two working PromQL queries in the AnalysisTemplate that validate application health during releases<a class="headerlink" href="#objective-3-two-working-promql-queries-in-the-analysistemplate-that-validate-application-health-during-releases" title="Permanent link">#</a></h3>
<p>This objective is closely tied to Objective 2. By fixing both metrics in the AnalysisTemplate (<code>container-restarts</code> and <code>ready-containers</code>) we ensured that application health is properly validated during each rollout. Both queries now work as intended:</p>
<ul>
<li><code>container-restarts</code>: Confirms there are no container restarts during the rollout.</li>
<li><code>ready-containers</code>: Checks that at least one container is ready before progressing.</li>
</ul>
<p>With these working PromQL queries, our rollouts are now protected by robust health checks. üéâ</p>
<h4 id="key-takeaways_2">Key Takeaways<a class="headerlink" href="#key-takeaways_2" title="Permanent link">#</a></h4>
<ul>
<li>PromQL queries in the AnalysisTemplate provide automated, reliable health validation for deployments.</li>
</ul>
<h3 id="objective-4-all-rollouts-complete-successfully">Objective 4: All rollouts complete successfully<a class="headerlink" href="#objective-4-all-rollouts-complete-successfully" title="Permanent link">#</a></h3>
<p>This objective is also directly connected to Objective 2 and 3. After correcting the metrics in the AnalysisTemplate, the rollout was able to progress through all canary stages and complete successfully in both environments.</p>
<p>With all objectives met, our deployment process is now fully automated and resilient!</p>
<h2 id="complete-solution">‚úÖ Complete Solution<a class="headerlink" href="#complete-solution" title="Permanent link">#</a></h2>
<p>Here's what your corrected <code>AnalysisTemplate</code> should look like with all fixes applied:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argoproj.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AnalysisTemplate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo-analysis</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container-restarts</span>
<span class="w">      </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result[0] == 0</span>
<span class="w">      </span><span class="nt">failureLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">inconclusiveLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">consecutiveErrorLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prometheus-server.prometheus.svc.cluster.local</span>
<span class="w">          </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no"># There should be no restarts</span>
<span class="w">            </span><span class="no">sum(increase(kube_pod_container_status_restarts_total{</span>
<span class="w">              </span><span class="no">namespace=&quot;{{args.namespace}}&quot;,</span>
<span class="w">              </span><span class="no">pod=~&quot;echo-server-.*&quot;</span>
<span class="w">            </span><span class="no">}[1m])) or vector(0)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ready-containers</span>
<span class="w">      </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result[0] &gt;= 1</span>
<span class="w">      </span><span class="nt">failureLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">inconclusiveLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">consecutiveErrorLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prometheus-server.prometheus.svc.cluster.local</span>
<span class="w">          </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">            </span><span class="no"># Check how many containers are ready (should be at least 1)</span>
<span class="w">            </span><span class="no">sum(kube_pod_container_status_ready{</span>
<span class="w">              </span><span class="no">namespace=&quot;{{args.namespace}}&quot;,</span>
<span class="w">              </span><span class="no">pod=~&quot;echo-server-.*&quot;</span>
<span class="w">            </span><span class="no">}) or vector(0)</span>
</code></pre></div>
<p>With these changes, your rollouts will now progress automatically through canary stages based on health metrics, and all objectives of the challenge will be met. Great job! üéâ</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>